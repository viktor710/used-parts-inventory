# Зависимости проекта

## Технологический стек

### Основные зависимости

#### Next.js 14
- **Версия**: ^14.2.32
- **Назначение**: React фреймворк с App Router
- **Использование**: Основная платформа приложения
- **Конфигурация**: `next.config.js`

#### TypeScript
- **Версия**: ^5
- **Назначение**: Типизированный JavaScript
- **Использование**: Типизация всего кода
- **Конфигурация**: `tsconfig.json`

#### React
- **Версия**: ^18.2.0
- **Назначение**: UI библиотека
- **Использование**: Компоненты интерфейса

#### Prisma
- **Версия**: ^6.15.0
- **Назначение**: ORM для работы с базой данных
- **Использование**: Доступ к PostgreSQL
- **Конфигурация**: `prisma/schema.prisma`

#### NextAuth.js
- **Версия**: ^4.24.11
- **Назначение**: Аутентификация и авторизация
- **Использование**: Управление сессиями пользователей
- **Адаптер**: @auth/prisma-adapter

### База данных

#### PostgreSQL
- **Тип**: Реляционная база данных
- **Назначение**: Основное хранилище данных
- **Подключение**: Через Prisma ORM
- **Переменные окружения**: `DATABASE_URL`, `DIRECT_URL`

### Облачные сервисы

#### Cloudinary
- **Версия**: ^2.7.0
- **Назначение**: Облачное хранение изображений
- **Использование**: Загрузка и обработка изображений
- **Интеграция**: `lib/cloudinary.ts`
- **Документация**: Изучать через Context7

#### Supabase (опционально)
- **Версия**: ^2.56.1
- **Назначение**: Альтернативная база данных
- **Использование**: Резервное хранилище
- **Документация**: Изучать через Context7

### Стилизация

#### Tailwind CSS
- **Версия**: ^3.3.0
- **Назначение**: CSS фреймворк
- **Использование**: Стилизация компонентов
- **Конфигурация**: `tailwind.config.ts`

#### PostCSS
- **Версия**: ^8
- **Назначение**: Обработка CSS
- **Конфигурация**: `postcss.config.js`

#### Autoprefixer
- **Версия**: ^10.0.1
- **Назначение**: Автоматическое добавление префиксов CSS

### Утилиты

#### Winston
- **Версия**: ^3.17.0
- **Назначение**: Система логирования
- **Использование**: Логирование приложения
- **Конфигурация**: `lib/logger.ts`

#### Zod
- **Версия**: ^4.1.5
- **Назначение**: Валидация данных
- **Использование**: Валидация API запросов
- **Конфигурация**: `lib/validation.ts`

#### bcryptjs
- **Версия**: ^3.0.2
- **Назначение**: Хеширование паролей
- **Использование**: Безопасность аутентификации
- **Настройки**: Cost factor 12+

#### Sharp
- **Версия**: ^0.34.3
- **Назначение**: Обработка изображений
- **Использование**: Оптимизация изображений

### UI компоненты

#### Lucide React
- **Версия**: ^0.294.0
- **Назначение**: Иконки
- **Использование**: UI иконки в компонентах

#### clsx
- **Версия**: ^2.0.0
- **Назначение**: Условные CSS классы
- **Использование**: Динамические стили

#### tailwind-merge
- **Версия**: ^2.0.0
- **Назначение**: Объединение Tailwind классов
- **Использование**: Утилита `utils/cn.ts`

### Инструменты разработки

#### Context7
- **Назначение**: Доступ к документации библиотек
- **Использование**: Изучение API и интеграция новых библиотек
- **Обязательно**: Перед интеграцией любой новой библиотеки

## Диаграмма зависимостей

```
┌─────────────────────────────────────────────────────────────┐
│                    Презентационный слой                     │
├─────────────────────────────────────────────────────────────┤
│  React Components (app/, components/)                       │
│  ├── Next.js 14 (App Router)                               │
│  ├── TypeScript                                            │
│  ├── Tailwind CSS                                          │
│  ├── Lucide React (иконки)                                 │
│  └── clsx + tailwind-merge                                 │
└─────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                      API слой                               │
├─────────────────────────────────────────────────────────────┤
│  Next.js API Routes (app/api/)                             │
│  ├── NextAuth.js (аутентификация)                          │
│  ├── Zod (валидация)                                       │
│  └── Middleware (авторизация)                              │
└─────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                   Бизнес-логика                             │
├─────────────────────────────────────────────────────────────┤
│  Business Logic (lib/)                                      │
│  ├── Prisma Client                                         │
│  ├── Winston (логирование)                                 │
│  ├── bcryptjs (хеширование)                                │
│  └── Cloudinary (изображения)                              │
└─────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                     Слой данных                             │
├─────────────────────────────────────────────────────────────┤
│  Data Layer                                                 │
│  ├── PostgreSQL (основная БД)                              │
│  ├── Prisma Schema                                         │
│  └── Cloudinary (файлы)                                    │
└─────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                  Внешние интеграции                         │
├─────────────────────────────────────────────────────────────┤
│  External APIs                                              │
│  ├── Context7 (документация)                               │
│  ├── Cloudinary (изображения)                              │
│  ├── Supabase (БД)                                         │
│  └── Vercel (хостинг)                                      │
└─────────────────────────────────────────────────────────────┘
```

## Детальные зависимости по модулям

### Аутентификация
```
NextAuth.js
├── @auth/prisma-adapter (адаптер БД)
├── bcryptjs (хеширование паролей)
├── Prisma Client (доступ к БД)
└── JWT (токены)
```

### Работа с данными
```
Prisma
├── PostgreSQL (база данных)
├── TypeScript (типизация)
└── Prisma Client (генерация)
```

### Обработка файлов
```
Cloudinary
├── Sharp (обработка изображений)
├── Next.js Image (оптимизация)
└── File Upload (загрузка)
```

### Валидация
```
Zod
├── TypeScript (типы)
├── API Routes (валидация запросов)
└── Forms (валидация форм)
```

### Логирование
```
Winston
├── winston-daily-rotate-file (ротация логов)
├── Console (вывод в консоль)
└── File (сохранение в файлы)
```

### Внешние API
```
Context7
├── Документация библиотек
├── API справочники
└── Примеры интеграций
```

## Конфигурационные файлы

### Next.js
```javascript
// next.config.js
module.exports = {
  images: {
    domains: ['res.cloudinary.com'],
  },
  experimental: {
    serverComponentsExternalPackages: ['@prisma/client'],
  },
}
```

### TypeScript
```json
// tsconfig.json
{
  "compilerOptions": {
    "target": "es5",
    "lib": ["dom", "dom.iterable", "es6"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "baseUrl": ".",
    "paths": {
      "@/*": ["./*"]
    }
  }
}
```

### Tailwind CSS
```javascript
// tailwind.config.ts
import type { Config } from 'tailwindcss'

const config: Config = {
  content: [
    './pages/**/*.{js,ts,jsx,tsx,mdx}',
    './components/**/*.{js,ts,jsx,tsx,mdx}',
    './app/**/*.{js,ts,jsx,tsx,mdx}',
  ],
  theme: {
    extend: {
      colors: {
        // Кастомные цвета
      },
    },
  },
  plugins: [],
}
export default config
```

### Prisma
```prisma
// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// Модели данных...
```

## Переменные окружения

### Обязательные
```env
# База данных
DATABASE_URL=postgresql://...
DIRECT_URL=postgresql://...

# Аутентификация
NEXTAUTH_SECRET=your-secret-key
NEXTAUTH_URL=http://localhost:3000

# Cloudinary
CLOUDINARY_URL=cloudinary://...
```

### Опциональные
```env
# Логирование
LOG_LEVEL=info
LOG_FILE=logs/app.log

# Разработка
NODE_ENV=development
DEBUG=true

# Внешние API
SUPABASE_URL=...
SUPABASE_ANON_KEY=...
SUPABASE_SERVICE_ROLE_KEY=...
```

### Переменные для внешних API
```env
# Cloudinary
CLOUDINARY_API_KEY=...
CLOUDINARY_API_SECRET=...
CLOUDINARY_CLOUD_NAME=...

# Supabase
SUPABASE_URL=...
SUPABASE_ANON_KEY=...
SUPABASE_SERVICE_ROLE_KEY=...

# Другие внешние сервисы
EXTERNAL_API_KEY=...
EXTERNAL_API_URL=...
EXTERNAL_API_SECRET=...
```

## Скрипты разработки

### Основные команды
```json
{
  "scripts": {
    "dev": "next dev",
    "build": "node scripts/fix-prisma-vercel.js && prisma generate && next build",
    "start": "next start",
    "lint": "next lint"
  }
}
```

### База данных
```json
{
  "scripts": {
    "db:generate": "prisma generate",
    "db:push": "prisma db push",
    "db:migrate": "prisma migrate dev",
    "db:studio": "prisma studio",
    "db:seed": "tsx scripts/init-database.ts"
  }
}
```

### Тестирование и качество
```json
{
  "scripts": {
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage",
    "lint": "eslint . --ext .ts,.tsx",
    "lint:fix": "eslint . --ext .ts,.tsx --fix",
    "type-check": "tsc --noEmit"
  }
}
```

## Совместимость версий

### Node.js
- **Минимальная версия**: 18.0.0
- **Рекомендуемая версия**: 20.x.x

### npm/yarn
- **npm**: 9.x.x или выше
- **yarn**: 1.22.x или выше

### База данных
- **PostgreSQL**: 12.x или выше
- **Supabase**: Совместим с PostgreSQL 12+

## Безопасность зависимостей

### Регулярные обновления
- Еженедельная проверка уязвимостей: `npm audit`
- Автоматическое обновление: `npm update`
- Проверка устаревших пакетов: `npm outdated`

### Критические зависимости
- **bcryptjs**: Для хеширования паролей
- **NextAuth.js**: Для аутентификации
- **Prisma**: Для безопасности БД
- **Zod**: Для валидации данных

### Мониторинг
- GitHub Dependabot для автоматических обновлений
- Регулярные проверки безопасности
- Логирование подозрительной активности

### Безопасность внешних API
- Валидация API ключей
- Санитизация данных от внешних сервисов
- Мониторинг подозрительной активности
- Rate limiting для внешних вызовов

## Интеграция новых зависимостей

### Процесс добавления
1. **Изучи документацию** через Context7
2. **Проверь совместимость** с текущим стеком
3. **Протестируй локально** перед добавлением
4. **Добавь в package.json** с точной версией
5. **Обнови DEPENDENCIES.md** с описанием
6. **Протестируй в staging** перед продакшном

### Критерии выбора
- **Активность разработки**: Регулярные обновления
- **Размер сообщества**: Популярность и поддержка
- **Лицензия**: Совместимость с проектом
- **Производительность**: Влияние на приложение
- **Безопасность**: Отсутствие известных уязвимостей

### Документирование
- Описание назначения и использования
- Примеры интеграции
- Troubleshooting
- Migration guides при обновлениях

## Мониторинг зависимостей

### Метрики
- Время загрузки страниц
- Размер бандла
- Количество HTTP запросов
- Использование памяти

### Алерты
- Высокое время ответа
- Много ошибок
- Необычная активность
- Проблемы с внешними API

### Логирование
- Все API запросы
- Ошибки и исключения
- Действия пользователей
- Производительность

## Документирование кода

### JSDoc комментарии с @tags
Система использует структурированное документирование для лучшего понимания контекста Cursor:

#### Основные принципы
- **Всегда документируй функции** с помощью JSDoc комментариев
- **Используй @tags** для структурирования документации
- **Пиши комментарии на русском языке** для лучшего понимания
- **Связывай функции с контекстом** через теги

#### Обязательные теги
```typescript
/**
 * @description Создает новый автомобиль в базе данных с валидацией данных
 * @param {CarData} carData - Данные автомобиля для создания
 * @param {PrismaClient} prisma - Экземпляр Prisma клиента
 * @returns {Promise<Car>} Созданный автомобиль
 * @throws {ValidationError} При ошибке валидации данных
 * @throws {DatabaseError} При ошибке базы данных
 */
export async function createCar(carData: CarData, prisma: PrismaClient): Promise<Car>
```

#### Дополнительные теги
- **@example** - Примеры использования
- **@since** - Версия добавления функции
- **@deprecated** - Устаревшие функции
- **@see** - Ссылки на связанные функции
- **@component** - React компоненты
- **@hook** - React хуки
- **@api** - API эндпоинты
- **@interface** - TypeScript интерфейсы
- **@type** - TypeScript типы
- **@business** - Бизнес-правила
- **@security** - Безопасность
- **@external** - Интеграция с внешними API

### Связывание контекста
- **@see** теги для связывания связанных функций
- **@example** теги для примеров использования
- **@since** теги для версионности
- **@deprecated** теги для устаревшего кода

---

**Последнее обновление**: Сентябрь 2024
**Версия документа**: 2.0.0
**Соответствует правилам**: .cursor/rules/main.mdc v2.0.0
