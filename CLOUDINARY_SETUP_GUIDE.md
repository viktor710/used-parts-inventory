# Руководство по настройке Cloudinary

## Обзор

Cloudinary - это облачная платформа для управления изображениями и видео. В нашем проекте мы используем Cloudinary для загрузки и хранения фотографий автомобилей и запчастей.

## Настройка аккаунта Cloudinary

### 1. Регистрация
1. Перейдите на [cloudinary.com](https://cloudinary.com)
2. Зарегистрируйте бесплатный аккаунт
3. Подтвердите email

### 2. Получение учетных данных
После регистрации вы получите:
- **Cloud Name** - имя вашего облака
- **API Key** - ключ для доступа к API
- **API Secret** - секретный ключ

Эти данные можно найти в Dashboard → Account Details.

## Настройка проекта

### 1. Установка зависимостей
```bash
npm install cloudinary next-cloudinary
```

### 2. Настройка переменных окружения
Создайте файл `.env.local` и добавьте:

```env
# Cloudinary Configuration
NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME=your_cloud_name
CLOUDINARY_API_KEY=your_api_key
CLOUDINARY_API_SECRET=your_api_secret
```

**Важно:** 
- `NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME` должен начинаться с `NEXT_PUBLIC_` для доступа на клиенте
- `CLOUDINARY_API_KEY` и `CLOUDINARY_API_SECRET` должны быть скрыты от клиента

### 3. Настройка для продакшена
Для Vercel или других платформ:
1. Добавьте переменные окружения в настройках проекта
2. Убедитесь, что все переменные правильно настроены

## Структура папок в Cloudinary

Изображения автоматически сохраняются в следующей структуре:
```
sait/
├── cars/          # Фотографии автомобилей
├── parts/         # Фотографии запчастей
└── general/       # Общие изображения
```

## Функциональность

### Загрузка изображений
- Поддержка drag & drop
- Множественная загрузка
- Автоматическое сжатие и оптимизация
- Предварительный просмотр

### Отображение изображений
- Галерея с предварительным просмотром
- Модальное окно для полноразмерного просмотра
- Навигация между изображениями
- Адаптивный дизайн

### Ограничения
- Максимум 10 изображений для автомобилей
- Максимум 8 изображений для запчастей
- Поддерживаемые форматы: JPG, PNG, GIF
- Максимальный размер файла: 10MB

## API Endpoints

### POST /api/upload
Загрузка изображения на Cloudinary

**Параметры:**
- `file` - файл изображения
- `folder` - папка для сохранения (cars/parts/general)

**Ответ:**
```json
{
  "success": true,
  "data": {
    "public_id": "sait/cars/image_123",
    "secure_url": "https://res.cloudinary.com/...",
    "url": "http://res.cloudinary.com/...",
    "width": 800,
    "height": 600,
    "format": "jpg"
  }
}
```

### DELETE /api/upload?publicId=...
Удаление изображения из Cloudinary

## Компоненты

### ImageUpload
Компонент для загрузки изображений с drag & drop.

**Props:**
- `images` - массив URL изображений
- `onImagesChange` - callback при изменении изображений
- `folder` - папка для сохранения
- `maxImages` - максимальное количество изображений

### ImageGallery
Компонент для отображения галереи изображений.

**Props:**
- `images` - массив URL изображений
- `maxPreview` - количество изображений для предварительного просмотра
- `showCount` - показывать ли счетчик изображений

## Безопасность

### Настройки Cloudinary
1. В Dashboard → Settings → Security:
   - Включите HTTPS только
   - Настройте CORS для вашего домена
   - Ограничьте размеры файлов

2. В Dashboard → Settings → Upload:
   - Настройте преобразования по умолчанию
   - Ограничьте форматы файлов
   - Установите лимиты размера

### Рекомендации
- Регулярно проверяйте использование хранилища
- Настройте уведомления о превышении лимитов
- Используйте разные папки для разных типов контента

## Мониторинг и аналитика

### Cloudinary Dashboard
- Отслеживание использования хранилища
- Статистика загрузок
- Аналитика производительности

### Логи
Все операции с изображениями логируются в консоли браузера и сервера.

## Устранение неполадок

### Частые проблемы

1. **Ошибка "Invalid API Key"**
   - Проверьте правильность API ключа
   - Убедитесь, что переменные окружения загружены

2. **Изображения не загружаются**
   - Проверьте CORS настройки
   - Убедитесь, что размер файла не превышает лимит

3. **Ошибка "Folder not found"**
   - Папки создаются автоматически
   - Проверьте права доступа к аккаунту

### Отладка
```javascript
// В консоли браузера
console.log('Cloudinary config:', {
  cloudName: process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME
});

// В API route
console.log('Upload result:', uploadResult);
```

## Обновления и миграции

При обновлении Cloudinary SDK:
1. Проверьте changelog
2. Обновите зависимости
3. Протестируйте функциональность
4. Обновите документацию

## Поддержка

- [Cloudinary Documentation](https://cloudinary.com/documentation)
- [Cloudinary API Reference](https://cloudinary.com/documentation/admin_api)
- [Next.js Cloudinary Integration](https://next-cloudinary.spacejelly.dev/)
